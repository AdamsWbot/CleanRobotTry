*本功能输入与输出统一使用角度制*
*本功能所有项目可通过 `roslaunch clean_robot project(1/2/3/4)` 一键启动*

# 机器人清洁挑战赛微缩考核

**开发环境**：Ubuntu 20.04 + ROS-Noetic

---

## 项目1：机械臂关节控制

### 功能说明
- **核心功能**：实现5轴机械臂的关节角度发布与状态订阅。
- **通信机制**：
  - **话题 (Topic)**：`/joint_states`
  - **消息类型 (Msg)**：`sensor_msgs/JointState`
- **参数配置 (源自 `config/config.py`)**：
  - **关节数量**：5轴
  - **关节范围**：0° ~ 270° (0.0 ~ 4.712 rad)
  - **初始位置**：`[0°, 30°, 60°, 90°, 120°]`
  - **复位位置**：`[0°, 0°, 0°, 0°, 0°]`

### 运行步骤
1.  确保已编译并激活环境。
2.  打开终端，运行：
    ```bash
    roslaunch clean_robot project1.launch
    ```
    > **提示**：发布节点支持手动终端输入修改关节角度，5轴机械臂关节角度取值 **0-270°**。终端输出频繁，建议输入采用复制粘贴。

### 指令示例

| 输入指令 | 效果 |
| :--- | :--- |
| `set 1 45` | 将 joint1 设为 45° |
| `set all 20 50 60 90 210` | 按序一次设置所有关节（单位°） |
| `reset` | 复位所有关节到 0° |

---

## 项目2：机械爪服务控制

此模块包含一个服务端（处理请求）和一个客户端（发送指令），通过服务通信控制机械爪开合。

- **服务端节点**：接收角度指令，控制机械爪动作并返回执行状态。
- **客户端节点**：向服务端发送目标角度，获取执行结果。

### 运行指令
1.  启动服务端（先运行）：
    ```bash
    rosrun clean_robot gripper_server.py
    ```
2.  启动客户端（后运行）：
    ```bash
    rosrun clean_robot gripper_client.py
    ```

### 输出示例
- **服务端输出**：
  ```text
  [INFO] 接收到请求，目标角度: 50.00°
  [WARN] 角度差值过小，无需动作
  ```
- **客户端交互**：
  ```text
  请输入目标角度 (0-90): 50
  [RESULT] 执行成功! 当前爪部角度: 50.00°
  ```

---

## 项目3：倾倒动作流程

复刻餐厅赛项核心动作：夹取 -> 抬升 -> 倾倒 -> 收纳。严格遵循赛事时序与参数。

### 动作流程
1.  **夹取**：机械爪闭合（90°），夹紧餐具。
2.  **抬升**：机械臂关节抬升至指定高度（joint2=60°, joint3=90°）。
3.  **倾倒**：机械臂关节旋转倾倒（joint4=150°），保持 1 秒。
4.  **收纳**：机械爪松开（0°），机械臂复位。

### 运行指令
1.  确保项目1（机械臂发布节点）和项目2（机械爪服务端）已启动。
2.  运行主程序：
    ```bash
    rosrun clean_robot pour_action.py
    ```

### 输出示例
- **程序启动**：
  ```text
  [INFO] 步骤1/6: 爪部闭合中...
  ```
- **动作执行**：
  ```text
  [INFO] 步骤3/6: 旋转倾倒中... joint4=150°
  ```
- **完成提示**：
  ```text
  [INFO] 所有动作执行完毕，程序退出。
  ```

---

## 项目4：夹爪状态发布与订阅

### 功能说明
- **核心功能**：实现机械臂末端执行器（夹爪）的开合控制，并反馈当前抓取状态。
- **通信机制**：
  - **发布话题 (Pub)**：`/gripper_state`（订阅状态）
  - **订阅话题 (Sub)**：`/gripper_cmd`（接收指令）
  - **消息类型 (Msg)**：`std_msgs/String`
- **控制逻辑**：
  - 接收到 `"open"` 指令时，夹爪张开。
  - 接收到 `"close"` 指令时，夹爪闭合。
  - 状态变化后，向 `/gripper_state` 发布当前状态。

### 模块文件
- `gripper_client.py`：客户端脚本，用于发送抓取指令。
- `gripper_server.py`：服务端脚本，监听指令并控制夹爪逻辑。
- `project4.launch`：ROS 启动文件，用于同时启动服务端和客户端节点。

### 运行步骤
1.  确保工作空间已编译并激活环境。
2.  打开终端，运行以下命令启动项目：
    ```bash
    roslaunch clean_robot project4.launch
    ```

### 高级配置
可通过修改 `config.py` 文件中项目4部分的参数来单独调用或不调用某个部分，并能控制调用次数，例如：
```python
RUN_FOOD_WASTE = False    # 不执行餐余垃圾清理
TABLEWARE_COUNT = 3       # 餐具清理执行3次
